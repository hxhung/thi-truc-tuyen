<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K·∫øt Qu·∫£ Thi</title>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0; 
            padding: 20px;
        }
        .result-card { 
            background: white; 
            width: 90%; 
            max-width: 450px; 
            padding: 40px; 
            border-radius: 20px; 
            text-align: center; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideUp 0.5s ease-out;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h2 {
            color: #333;
            margin: 0 0 10px 0;
            font-size: 1.8rem;
        }
        .student-info {
            color: #666;
            margin: 10px 0 30px 0;
            font-size: 1rem;
        }
        .score-circle { 
            width: 140px; 
            height: 140px; 
            background: linear-gradient(135deg, #28a745, #20c997);
            border-radius: 50%; 
            margin: 20px auto; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            color: white; 
            font-size: 3rem; 
            font-weight: bold; 
            border: 5px solid #d4edda;
            box-shadow: 0 8px 16px rgba(40, 167, 69, 0.3);
        }
        .detail-box { 
            background: #f8f9fa; 
            border-radius: 10px; 
            padding: 20px; 
            margin: 30px 0; 
            text-align: left; 
        }
        .detail-row { 
            display: flex; 
            justify-content: space-between; 
            padding: 10px 0; 
            border-bottom: 1px dashed #ddd;
            align-items: center;
        }
        .detail-row:last-child {
            border-bottom: none;
        }
        .detail-label {
            color: #555;
            font-size: 0.95rem;
        }
        .detail-value {
            font-weight: bold;
            color: #333;
            font-size: 1.05rem;
        }
        .btn { 
            display: block; 
            width: 100%; 
            padding: 15px; 
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white; 
            border: none; 
            border-radius: 8px; 
            font-size: 16px; 
            font-weight: bold; 
            cursor: pointer; 
            margin-top: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }
        .btn:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 123, 255, 0.4);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }
        .error-msg {
            color: #dc3545;
            padding: 20px;
            background: #fff5f5;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="result-card">
        <h2>üéØ K·∫æT QU·∫¢ B√ÄI THI</h2>
        <div class="student-info" id="student-info">ƒêang t·∫£i...</div>
        
        <div class="score-circle" id="final-score">0.0</div>
        
        <div class="detail-box">
            <div class="detail-row">
                <span class="detail-label">üìù Tr·∫Øc nghi·ªám:</span>
                <strong class="detail-value" id="p1">0 ƒëi·ªÉm</strong>
            </div>
            <div class="detail-row">
                <span class="detail-label">‚öñÔ∏è ƒê√∫ng/Sai:</span>
                <strong class="detail-value" id="p2">0 ƒëi·ªÉm</strong>
            </div>
            <div class="detail-row">
                <span class="detail-label">‚úèÔ∏è ƒêi·ªÅn s·ªë:</span>
                <strong class="detail-value" id="p3">0 ƒëi·ªÉm</strong>
            </div>
        </div>

        <button class="btn" onclick="window.location.href='https://hxhung.github.io/web-trac-nghiem/index.html'">
            üè† V·ªÅ TRANG CH·ª¶
        </button>
        <button class="btn btn-secondary" onclick="window.location.href='https://hxhung.github.io/web-trac-nghiem/statistics.html'">
            üìä Xem Th·ªëng K√™
        </button>
    </div>

    <script>
        // ===== LOAD K·∫æT QU·∫¢ KHI TRANG M·ªû =====
        document.addEventListener('DOMContentLoaded', () => {
            loadResult();
        });

        function loadResult() {
            try {
                const raw = sessionStorage.getItem('examResult');
                
                if (!raw) {
                    showError('Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ thi. Vui l√≤ng l√†m b√†i l·∫°i.');
                    return;
                }

                const data = JSON.parse(raw);
                console.log('üìä D·ªØ li·ªáu k·∫øt qu·∫£:', data);

                // Ki·ªÉm tra c·∫•u tr√∫c d·ªØ li·ªáu
                if (!data.success) {
                    showError(data.message || 'C√≥ l·ªói x·∫£y ra khi ch·∫•m b√†i.');
                    return;
                }

                // 1. HI·ªÇN TH·ªä TH√îNG TIN TH√ç SINH
                const name = data.studentName || localStorage.getItem('lastStudentName') || "Th√≠ sinh";
                const sClass = data.studentClass || localStorage.getItem('lastStudentClass') || "";
                document.getElementById('student-info').textContent = `${name}${sClass ? ' - ' + sClass : ''}`;

                // 2. HI·ªÇN TH·ªä ƒêI·ªÇM T·ªîNG
                const totalScore = parseFloat(data.score || 0);
                document.getElementById('final-score').textContent = totalScore.toFixed(1);

                // ƒê·ªïi m√†u theo ƒëi·ªÉm
                const scoreCircle = document.getElementById('final-score');
                if (totalScore >= 8) {
                    scoreCircle.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
                } else if (totalScore >= 6.5) {
                    scoreCircle.style.background = 'linear-gradient(135deg, #007bff, #0056b3)';
                } else if (totalScore >= 5) {
                    scoreCircle.style.background = 'linear-gradient(135deg, #ffc107, #ff9800)';
                } else {
                    scoreCircle.style.background = 'linear-gradient(135deg, #dc3545, #c82333)';
                }

                // 3. HI·ªÇN TH·ªä ƒêI·ªÇM CHI TI·∫æT
                const details = data.details || {};
                
                const p1Score = parseFloat(details.p1 || 0);
                const p2Score = parseFloat(details.p2 || 0);
                const p3Score = parseFloat(details.p3 || 0);

                document.getElementById('p1').textContent = p1Score.toFixed(2) + ' ƒëi·ªÉm';
                document.getElementById('p2').textContent = p2Score.toFixed(2) + ' ƒëi·ªÉm';
                document.getElementById('p3').textContent = p3Score.toFixed(2) + ' ƒëi·ªÉm';

                // 4. X√ìA D·ªÆ LI·ªÜU K·∫æT QU·∫¢ KH·ªéI SESSION (tr√°nh xem l·∫°i nhi·ªÅu l·∫ßn)
                // sessionStorage.removeItem('examResult'); // T√πy ch·ªçn

            } catch (error) {
                console.error('‚ùå L·ªói load k·∫øt qu·∫£:', error);
                showError('L·ªói hi·ªÉn th·ªã k·∫øt qu·∫£: ' + error.message);
            }
        }

        function showError(message) {
            const card = document.querySelector('.result-card');
            card.innerHTML = `
                <h2 style="color: #dc3545;">‚ùå L·ªñI</h2>
                <div class="error-msg">${message}</div>
                <button class="btn" onclick="window.location.href='https://hxhung.github.io/web-trac-nghiem/index.html'">
                    üè† V·ªÅ TRANG CH·ª¶
                </button>
            `;
        }
    </script>
</body>
</html>
