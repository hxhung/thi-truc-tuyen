<!DOCTYPE html>

<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>V√†o Ph√≤ng Thi | H·ªá th·ªëng Thi Tr·ª±c Tuy·∫øn</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="H·ªá th·ªëng thi tr·ª±c tuy·∫øn m√¥n To√°n THPT">


<!-- API Connector -->
<script src="assets/js/api-connector.js"></script>

<!-- SVG ICONS (INLINE, UTF-8 SAFE) -->
<style>
    :root {
        --primary:#007bff;--primary-dark:#0056b3;
        --secondary:#6c757d;--secondary-dark:#5a6268;
        --danger:#dc3545;--success:#28a745;--warning:#ffc107;
        --bg-card:#fff;--text-main:#333;--text-muted:#555;--border:#ddd;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
        font-family:Segoe UI,Tahoma,Verdana,sans-serif;
        min-height:100vh;display:flex;align-items:center;justify-content:center;
        background:linear-gradient(135deg,#667eea,#764ba2);padding:20px
    }
    #login-box{
        width:100%;max-width:380px;background:#fff;border-radius:16px;
        padding:40px 35px;box-shadow:0 10px 40px rgba(0,0,0,.2)
    }
    .header{text-align:center;margin-bottom:28px}
    .header-icon{
        width:64px;height:64px;border-radius:50%;margin:0 auto 12px;
        display:flex;align-items:center;justify-content:center;
        background:linear-gradient(135deg,#667eea,#764ba2)
    }
    h2{font-size:24px;color:var(--text-main);margin-bottom:6px}
    .subtitle{font-size:14px;color:var(--text-muted)}
    .input-group{margin-bottom:16px;text-align:left}
    label{display:block;font-size:14px;font-weight:600;margin-bottom:6px;color:var(--text-muted)}
    .input-wrapper{position:relative}
    .input-icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);opacity:.6}
    input{
        width:100%;padding:12px 12px 12px 40px;font-size:15px;
        border:2px solid var(--border);border-radius:8px;background:#fafafa
    }
    input:focus{outline:none;border-color:var(--primary);background:#fff}
    input.error{border-color:var(--danger)}
    input.success{border-color:var(--success)}
    button{
        width:100%;padding:13px;border-radius:8px;border:none;
        font-size:16px;font-weight:600;cursor:pointer;margin-bottom:12px
    }
    .btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff}
    .btn-secondary{background:var(--secondary);color:#fff}
    .btn-primary:disabled{background:#ccc;cursor:not-allowed}
    #msg{min-height:24px;margin:12px 0;font-size:14px;text-align:center}
    #msg.error{color:var(--danger)}
    #msg.success{color:var(--success)}
    #msg.info{color:var(--primary)}
    #late-section{display:none;border-top:2px dashed #e0e0e0;padding-top:12px;margin-top:12px}
    .footer{text-align:center;margin-top:18px;font-size:13px;color:var(--text-muted)}
    .spinner{
        width:18px;height:18px;border:3px solid #eee;border-top:3px solid var(--primary);
        border-radius:50%;display:inline-block;animation:spin 1s linear infinite
    }
    @keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>
<div id="login-box">
    <div class="header">
        <div class="header-icon" aria-hidden="true">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M3 4h18v16H3z"/><path d="M7 8h10M7 12h10M7 16h6"/></svg>
        </div>
        <h2>V√ÄO PH√íNG THI</h2>
        <p class="subtitle">H·ªá th·ªëng thi tr·ª±c tuy·∫øn m√¥n To√°n THPT</p>
    </div>


<div class="input-group">
    <label for="studentName">H·ªç v√† t√™n *</label>
    <div class="input-wrapper">
        <span class="input-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="7" r="4"/><path d="M5.5 21a6.5 6.5 0 0 1 13 0"/></svg>
        </span>
        <input id="studentName" type="text" placeholder="Nh·∫≠p h·ªç t√™n ƒë·∫ßy ƒë·ªß" required>
    </div>
</div>

<div class="input-group">
    <label for="studentClass">L·ªõp *</label>
    <div class="input-wrapper">
        <span class="input-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 10v6M2 10v6"/><path d="M6 8l6-4 6 4v8l-6 4-6-4z"/></svg>
        </span>
        <input id="studentClass" type="text" placeholder="VD: 12A1" required>
    </div>
</div>

<div class="input-group">
    <label for="examId">M√£ ƒë·ªÅ thi *</label>
    <div class="input-wrapper">
        <span class="input-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16v16H4z"/><path d="M7 8h10M7 12h10M7 16h6"/></svg>
        </span>
        <input id="examId" type="text" placeholder="VD: TOAN12" required>
    </div>
</div>

<div id="late-section">
    <div class="input-group">
        <label for="lateCode" style="color:var(--danger)">M√£ v√†o mu·ªôn *</label>
        <div class="input-wrapper">
            <input id="lateCode" type="text" placeholder="M√£ do gi√°m th·ªã cung c·∫•p">
        </div>
        <small>‚è∞ B·∫°n v√†o mu·ªôn, vui l√≤ng nh·∫≠p m√£ x√°c nh·∫≠n.</small>
    </div>
</div>

<div id="msg"></div>

<button id="btn-submit" class="btn-primary" onclick="checkAndStart()">B·∫Øt ƒë·∫ßu thi</button>
<button class="btn-secondary" onclick="location.href='https://hxhung.github.io/web-trac-nghiem/'">Trang ch·ªß</button>

<div class="footer">C·∫ßn h·ªó tr·ª£? <a href="https://hxhung.github.io/web-trac-nghiem/lienhe.html" target="_blank">Li√™n h·ªá</a></div>


</div>

<script>
const el={
 name:studentName,
 studentClass:studentClass,
 examId:examId,
 lateCode:lateCode,
 btn:document.getElementById('btn-submit'),
 msg:msg,
 late:document.getElementById('late-section')
};

async function checkAndStart(){
 const name=el.name.value.trim();
 const cls=el.studentClass.value.trim();
 const eid=el.examId.value.trim().toUpperCase();
 clearMsg();
 if(!name||name.length<3)return error('Vui l√≤ng nh·∫≠p h·ªç t√™n h·ª£p l·ªá');
 if(!/^(10|11|12)[A-Z][0-9]?$/.test(cls))return error('L·ªõp kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng');
 if(!/^[A-Z0-9]+$/.test(eid))return error('M√£ ƒë·ªÅ kh√¥ng h·ª£p l·ªá');
 if(typeof checkExamAccess!=='function')return error('L·ªói k·∫øt n·ªëi h·ªá th·ªëng');
 el.btn.disabled=true;el.btn.innerHTML='<span class="spinner"></span> ƒêang x·ª≠ l√Ω';
 try{
   const acc=await checkExamAccess(eid,el.lateCode.value.trim());
   if(!acc.success){
     error(acc.message||'Kh√¥ng th·ªÉ truy c·∫≠p ƒë·ªÅ');
     if(acc.status==='REQUIRE_CODE')el.late.style.display='block';
     return;
   }
   const q=await getQuestions(eid);
   if(!q.success)return error('Kh√¥ng t·∫£i ƒë∆∞·ª£c ƒë·ªÅ');
   sessionStorage.setItem(
  'currentExam',
  JSON.stringify({
    examId: eid,
    title: acc.title,
    duration: acc.duration,
    studentName: name,
    studentClass: cls,
    questions: q.data,
    startToken: Date.now()   // üî¥ B·∫ÆT BU·ªòC ‚Äì KH√ìA PHI√äN
  })
);
   success('ƒêang v√†o ph√≤ng thi...');
   setTimeout(()=>location.href='exam.html',500);
 }catch{error('L·ªói m√°y ch·ªß');}
 finally{el.btn.disabled=false;el.btn.innerHTML='B·∫Øt ƒë·∫ßu thi'}
}
function error(t){el.msg.className='error';el.msg.textContent='‚ùå '+t}
function success(t){el.msg.className='success';el.msg.textContent='‚úÖ '+t}
function clearMsg(){el.msg.className='';el.msg.textContent=''}
examId.addEventListener('input',e=>e.target.value=e.target.value.toUpperCase());
</script>

</body>
</html>